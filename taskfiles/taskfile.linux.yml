version: '3'

includes:
  helper: "./taskfile.helper.yml"

tasks:

  default:
    internal: true
    desc: Default
    cmds:
      - |
        echo "Working dir: {{.USER_WORKING_DIR}}"
        echo "OS: {{OS}}"
        task --list
    silent: true

  assert-pacman:
    internal: true
    platforms: [linux]
    cmds:
      - task: helper:assert
        vars:
          REQUIRED_TOOLS: pacman

  assert-yay:
    internal: true
    platforms: [linux]
    cmds:
      - task: helper:assert
        vars:
          REQUIRED_TOOLS: yay

  setup:
    deps: [assert-pacman]
    internal: true
    desc: Install linux
    platforms: [linux]
    cmds:
      - task: base
      - task: yay
      - task: wifibluetooth
      - task: audio
      - task: config
      - task: dev
      - task: :sdkman:setup
      - task: :python:setup
      - task: productivity
      - task: keyboard
      - task: mouse
      - task: :submodules:init
      - task: :zimfw:install
      - task: :zsh:shell

  update:
    deps: [assert-pacman, assert-yay]
    desc: Run update tasks
    platforms: [linux]
    cmds:
      - task: helper:assert
        vars:
          REQUIRED_TOOLS: yay, pacman
      - yay -Syu --noconfirm
      - task: :zimfw:refresh

  k2:
    desc: Enable keychron fn keys
    platforms: [linux]
    cmds:
      - sudo systemctl start keychron

  base:
    deps: [assert-pacman]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/01-base.sh"

  yay:
    internal: true
    desc: Install development packages
    platforms: [linux]
    status:
      - test -f "{{.YAY_BIN}}"
    cmds:
      - mkdir -p ~/foundry/depository
      - "{{.ROOT_DIR}}/installation/linux/02-yay.sh"
    vars:
      YAY_BIN:
        sh: which yay || true

  wifibluetooth:
    deps: [assert-pacman]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/04-wireless-bluetooth.sh"

  audio:
    deps: [assert-pacman]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/05-audio.sh"

  productivity:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/07-productivity.sh"

  config:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    vars:
      CONFIG: "{{.HOME}}/.config"
      EXTRAS: "{{.ROOT_DIR}}/installation/linux/extras"
    cmds:
      - mkdir -p "$HOME/.config/gtk-3.0"
      - mkdir -p "$HOME/.local/bin"
      - rm -rf "$HOME/.config/mimeapps.list"
      - cp "{{.EXTRAS}}/mimeapps.list" "{{.CONFIG}}"
      - rm -rf "$HOME/user-dirs"
      - cp "{{.EXTRAS}}/user-dirs.dirs" "{{.CONFIG}}"

  dev:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/23-development.sh"

  keyboard:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/31-keyboard.sh"

  mouse:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    status:
      - test -f "{{.LOGID_BIN}}"
    cmds:
      - "{{.ROOT_DIR}}/installation/linux/32-mouse.sh"
    vars:
      LOGID_BIN:
        sh: which logid || true

  games:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - task: helper:assert
        vars:
          REQUIRED_TOOLS: yay
      - "{{.ROOT_DIR}}/installation/linux/53-gaming.sh"

  awesome:
    deps: [assert-yay]
    desc: Install linux
    platforms: [linux]
    cmds:
      - task: setup
      - task: :stow:awesome
      - task: awesome-setup

  awesome-setup:
    deps: [assert-yay]
    internal: true
    desc: Install development packages
    platforms: [linux]
    cmds:
      - cmd: "{{.ROOT_DIR}}/installation/linux/50-awesomewm.sh"
        ignore_error: true

  qtile:
    deps: [assert-yay]
    desc: Install linux
    platforms: [linux]
    cmds:
      - task: setup
      - task: :stow:qtile
      - "{{.ROOT_DIR}}/installation/linux/51-qtile.sh"

  gnome:
    deps: [assert-yay]
    desc: Install linux
    platforms: [linux]
    cmds:
      - task: setup
      - task: :stow:gnome
      - task: gnome-setup
      - "{{.ROOT_DIR}}/installation/linux/52-gnome.sh"
      - task: games
